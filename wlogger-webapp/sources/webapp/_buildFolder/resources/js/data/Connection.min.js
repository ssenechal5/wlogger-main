Ext.override(Ext.data.Connection,{extraParams:{},requires:[],request:function(c){c=c||{};var f=this,e=c.scope||window,h=c.username||f.username,b=c.password||f.password||"",d,a,g;if(f.fireEvent("beforerequest",f,c)!==false){a=f.setOptions(c,e);if(f.isFormUpload(c)){f.upload(c.form,a.url,a.data,c);return null}if(c.autoAbort||f.autoAbort){f.abort()}d=c.async!==false?(c.async||f.async):false;g=f.openRequest(c,a,d,h,b);if(!Ext.isEmpty(WirelessLogger)&&!Ext.isEmpty(WirelessLogger.util)&&!Ext.isEmpty(WirelessLogger.util.Keycloak)&&WirelessLogger.util.Keycloak.isReady()){WirelessLogger.util.Keycloak.updateToken(function(){f.finishRequest(c,a,d,g)},function(i){console.log("impossible to update token",i)});return null}return f.finishRequest(c,a,d,g)}else{Ext.callback(c.callback,c.scope,[c,undefined,undefined]);return null}},finishRequest:function(c,a,d,h){var f=this,g;var b=false;if(!b){g=f.setupHeaders(h,c,a.data,a.params)}var e={id:++Ext.data.Connection.requestId,xhr:h,headers:g,options:c,async:d,timeout:Ext.defer(function(){e.timedout=true;f.abort(e)},c.timeout||f.timeout)};f.requests[e.id]=e;f.latestId=e.id;if(d){if(!b){h.onreadystatechange=Ext.Function.bind(f.onStateChange,f,[e])}}if(b){f.processXdrRequest(e,h)}h.send(a.data);if(!d){return f.onComplete(e)}return e},setupHeaders:function(f,b,d,e){var a=this.callParent(arguments);if(!Ext.isEmpty(WirelessLogger)&&!Ext.isEmpty(WirelessLogger.util)&&!Ext.isEmpty(WirelessLogger.util.Keycloak)){var c=WirelessLogger.util.Keycloak.getToken();if(!Ext.isEmpty(c)){a.Authorization="Bearer "+c;f.setRequestHeader("Authorization","Bearer "+c);if(com.actility.global.modeDEV){f.setRequestHeader("X-Realm-ID",WirelessLogger.util.Config.getKeyConfig("keycloak.dev.realm"))}}}return a},createResponse:function(d){var c=this.callParent(arguments);var b=c.status;if(b>=400){if(Ext.String.startsWith(c.getResponseHeader("Content-Type"),"application/json")){var a=Ext.JSON.decode(c.responseText);console.error("["+a.code+"] "+a.message)}}return c}});