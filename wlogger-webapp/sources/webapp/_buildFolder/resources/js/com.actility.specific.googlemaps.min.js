Ext.define("com.actility.specific.googlemaps",{statics:{_translatePosition:function(a,b){if(GPS.isInChina(a,b)&&com.actility.global.gmapsEcjEncryptMode){return translatedPos=GPS.gcj_encrypt(a,b)}else{return{lat:a,lon:b}}},_getPosition:function(a,b){translatedPos=this._translatePosition(a,b);return new google.maps.LatLng(translatedPos.lat,translatedPos.lon)},_getInfoWindow:function(a){if(typeof a.infowindow=="undefined"){a.infowindow=new google.maps.InfoWindow()}return a.infowindow},_extendMap:function(a,c){if(typeof a.bounds=="undefined"){var b={strokeColor:"#FF0000",strokeOpacity:0,strokeWeight:2,fillColor:"#FF0000",fillOpacity:0,map:a,center:c,radius:50};lrrCircle=new google.maps.Circle(b);a.bounds=lrrCircle.getBounds();a.fitBounds(lrrCircle.getBounds())}else{a.bounds.extend(c);a.fitBounds(a.bounds)}},externalApiLoaded:function(){var a=["resources/js/gmaps.markerclusterer/markerclusterer.min.js","resources/js/ux/GMapPanel.min.js","resources/js/gps.min.js"];var b=new ScriptLoader(a,com.actility.specific.googlemaps.callbackAfterApiLoaded,com.actility.specific.googlemaps.callbackAfterApiLoadedParameters);b.loadFiles()},loadMapDependencies:function(c,a){var b=[com.actility.global.gmapsUrl];com.actility.specific.googlemaps.callbackAfterApiLoaded=c;com.actility.specific.googlemaps.callbackAfterApiLoadedParameters=a;var d=new ScriptLoader(b,function(){},null);d.loadFiles()},isLoaded:function(){return(typeof google=="object")},displayPolyline:function(c,f,b){var a=[];for(var d=0;d<f.length;d++){a.push(this._getPosition(f[d].lat,f[d].lon))}var e=new google.maps.Polyline({path:a,strokeColor:b,strokeOpacity:1,strokeWeight:2});e.setMap(c)},displayBullet:function(g,k,a,j,c,h,d,b,m){if(m==true){if(typeof g.clusterMarker=="undefined"){var e=[];var n={imagePath:"resources/images/gmaps.markerclusterer/m",maxZoom:12};g.clusterMarker=new MarkerClusterer(g,e,n)}}var i=new google.maps.MarkerImage("https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld="+b+"|"+d,null,null,null,new google.maps.Size(15,15));var l=this._getPosition(k,a);var f=new google.maps.Marker({position:l,map:g,icon:i});google.maps.event.addListener(f,"mouseover",(function(o,p){return function(){var q=com.actility.specific.googlemaps._getInfoWindow(g);q.setContent(j);q.open(g,o)}})(f,h));if(m==true){g.clusterMarker.addMarker(f)}com.actility.specific.googlemaps._extendMap(g,l);return f},displayLRR:function(d,f,g,e,c,b){var h=new google.maps.LatLng(f,g);var a=new google.maps.Marker({position:this._getPosition(f,g),map:d,icon:com.actility.global.buildUrl("/gui/resources/images/lrr_"+b+".png")});google.maps.event.addListener(a,"mouseover",(function(j,k){return function(){var i=com.actility.specific.googlemaps._getInfoWindow(d);i.setContent(e);i.open(d,j)}})(a,c));com.actility.specific.googlemaps._extendMap(d,h)},buildMapPanel:function(a){var c=Ext.create("Ext.window.Window",{title:a.title,layout:"fit",width:450,height:450,x:10,y:10,border:true,maximizable:true,items:{xtype:"gmappanel",gmapType:"map",zoomLevel:14,zoom:13,center:this._getPosition(0,0),mapOptions:{panControl:true,zoonControl:true,overviewMapControl:true,streetViewControl:true,scaleControl:true,navigationControl:true,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL,position:google.maps.ControlPosition.TOP_RIGHT},mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},mapTypeId:google.maps.MapTypeId.ROADMAP},listeners:{mapready:b}}});function b(d,e){api=e;a.onMapReady.call(this,e,a)}c.show()}}});