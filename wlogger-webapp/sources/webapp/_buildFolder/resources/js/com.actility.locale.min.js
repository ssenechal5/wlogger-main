Ext.define("com.actility.locale",{statics:{translate:function(d){var b=/^\$\{(.+)\}$/gm;var a=b.exec(d);if(a&&a[1]){d=a[1]}var c=com.actility.locale.translator[d];if(c!==undefined){return c}return d},translateLogin:function(a){if(com.actility.global.adminLogin){return com.actility.locale.translate("LBL LOGIN ADMIN")}else{return com.actility.locale.translate("LBL LOGIN")}},translateErrorMessage:function(e,b){var d="";for(var a=0;a<com.actility.locale.errorMessages.length;a++){var c=com.actility.locale.errorMessages[a];if(c.code==e){d=c.msg}}if(d.length>0){return d}return b},toTranslate:{title:function(a,b){if(a.setTitle){a.setTitle(b)}},html:function(a,b){},value:function(a,b){if(a.setValue){a.setValue(b)}},text:function(a,b){if(a.setText){a.setText(b)}},fieldLabel:function(a,b){if(a.labelEl){a.labelEl.update(b+":")}},tooltip:function(a,b){if(a.setTooltip){a.setTooltip(b)}},blankText:function(a,b){},emptyText:function(a,b){},boxLabel:function(a,b){if(a.boxLabelEl){a.boxLabel.update(b)}}},applytranslate:function(b){for(var a in com.actility.locale.toTranslate){if(b[a]){if(typeof b.beforeTranslate=="undefined"){b.beforeTranslate=Object();b.beforeTranslate[a]=b[a]}b[a]=com.actility.locale.localize(b[a])}}},storeretranslate:function(){Ext.each(Ext.StoreManager.items,function(b){try{if(b.load&&b.retranslate){b.load()}}catch(a){console.trace();console.warn(a)}})},applyretranslate:function(b){if(typeof b=="undefined"){return false}if((!b.xtype)||(typeof b.beforeTranslate=="undefined")){return false}if(b.childNodes&&b.data&&b.commit){b.set("text",com.actility.locale.localize(b.beforeTranslate.text));b.commit();return}for(var a in com.actility.locale.toTranslate){if(b.beforeTranslate[a]){b[a]=com.actility.locale.localize(b.beforeTranslate[a]);com.actility.locale.toTranslate[a].apply(this,[b,b[a]])}}},retranslate:function(b){if(typeof b=="undefined"){return false}if(typeof b.beforeTranslate!="undefined"){this.applyretranslate(b)}if(b.items){if(b.items instanceof Array){for(var a in b.items){this.retranslate(b.items[a])}}else{this.retranslate(b.items)}}if(b.dockedItems){if(b.dockedItems instanceof Array){for(var a in b.dockedItems){this.retranslate(b.dockedItems[a])}}else{this.retranslate(b.dockedItems)}}if(b.childNodes){if(b.childNodes instanceof Array){for(var a in b.childNodes){this.retranslate(b.childNodes[a])}}else{this.retranslate(b.childNodes)}}if(b.xtype&&b.xtype=="treepanel"){if(b.store&&b.store.tree){this.retranslate(b.store.tree.getRootNode())}}},localize:function(b){if(!Ext.isString(b)){return b}if(b.indexOf("${")<0){return b}var a=[];while(a=b.match(/\$\{(.+?)\}/)){b=b.replace(a[0],this.translate(a[1]))}return b},translator:[],errorMessages:[],loaderrors:function(d,f){if(d.urlPath){var g=d.success||function(i){var h=Ext.decode(i.responseText);com.actility.locale.errorMessages=h};var c=d.failure||function(){console.error("Unable to load default language for errors: "+d.lang);com.actility.locale.loaderrors({urlPath:com.actility.global.buildUrl("/rest/resources/files/errors"),params:d.params},{})};var e=new RegExp("({{lang}})","g");var b=d.urlPath.replace(e,d.lang);var a={method:"GET",url:b,failure:Ext.emptyFn,params:d.params,continueOnFailure:true,callback:function(i,j,h){if(j){g(h)}else{c(h)}}};Ext.Ajax.request(a)}},load:function(e,j){var g="en-US";if(e.urlPath){var b=e.lang||Ext.Object.fromQueryString(location.search.substring(1)).lang||navigator.language||window.navigator.languages[0]||window.navigator.languages[2]||g;b=b.replace("_","-");e.lang=b;var f=e.callback;var i=e.success||function(l){var k=Ext.decode(l.responseText);com.actility.locale.translator=k;f.call(j,b)};var d=e.failure||function(){if(b!==g){e.lang=g;com.actility.locale.load(e,j)}else{console.error("Unable to load default language: "+g)}};var c=new RegExp("({{lang}})","g");var a=e.urlPath.replace(c,b);var h={method:"GET",url:a,failure:Ext.emptyFn,params:e.params,continueOnFailure:true,callback:function(l,m,k){if(m){i(k)}else{d(k)}}};Ext.Ajax.request(h)}}}});Ext.override(Ext.data.TreeStore,{translateNode:function(b){if(b.raw&&b.raw.text){if(typeof b.beforeTranslate=="undefined"){b.beforeTranslate=Object();b.beforeTranslate.text=b.get("text")}b.set("text",com.actility.locale.localize(b.raw.text));b.commit()}if(b.raw&&b.raw.isLeaf){return}if(b.childNodes){for(var a=0;a<b.childNodes.length;a++){this.translateNode(b.childNodes[a])}}},constructor:function(){if(arguments[0].root){this.translateNode(arguments[0].root)}this.callOverridden(arguments);this.on("load",this.translateTree)},translateTree:function(){this.translateNode(this.tree.root)}});Ext.override(Ext.AbstractComponent,{constructor:function(){for(var a in arguments){com.actility.locale.applytranslate(arguments[a])}this.callOverridden(arguments)}});