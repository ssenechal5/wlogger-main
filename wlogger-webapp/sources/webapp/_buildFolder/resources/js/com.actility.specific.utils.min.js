Ext.define("com.actility.specific.utils",{statics:{windowUnload:function(b){var a="Want to exit ?";b=b||b.event;if(b){b.returnValue=a}return a},startTrackingUnload:function(){if(window.addEventListener){window.addEventListener("beforeunload",com.actility.specific.utils.windowUnload,false)}else{if(window.attachEvent){window.attachEvent("onbeforeunload",com.actility.specific.utils.windowUnload)}}},stopTrackingUnload:function(){if(window.removeEventListener){window.removeEventListener("beforeunload",com.actility.specific.utils.windowUnload)}else{if(window.detachEvent){window.detachEvent("onbeforeunload",com.actility.specific.utils.windowUnload)}}},logout:function(b,a){var c=com.actility.global.userId;com.actility.ajax.ajaxCall({method:"POST",url:com.actility.global.buildUrl("/rest/users/"+c+"/logout?sessionToken="+com.actility.global.sessionToken),callbackSuccess:function(d){b.call(this);com.actility.specific.extjs.toolStopDashboardRefresh();Ext.getCmp("rootViewport").destroy();Ext.WindowMgr.each(function(e){var f=e.title;if(f!=undefined){if((f.substr(0,3)=="Map")||(f.substr(0,4)=="Path")){e.destroy()}}});com.actility.specific.utils.stopTrackingUnload();com.actility.login.displaySSOLoginPopup(com.actility.global.thingparkApplicationID,location.hostname)},callbackError:function(e,d){a.call(this);com.actility.specific.extjs.specificWarning(Ext.getCmp("footer"),com.actility.locale.translate("WR Unable to logout, please reload the page"))}})},colorRssi:function(a){if(a>=-100){return"#18e314"}else{if(a>=-110){return"orange"}else{return"red"}}},colorSnr:function(a){if(a>=-8){return"#18e314"}else{if(a>=-13){return"orange"}else{return"red"}}},colorSf:function(a){if(a<=10){return"#18e314"}else{if(a<=11){return"orange"}else{return"red"}}},mapColor:function(b){var a=["3300FF","37FF00","FFFF00","FF0000","00B6FF","FF7B00","FFFFFF","22491E","49251E","FF00DD"];return a[b%a.length]},mapExecuteOrLoadMapAPI:function(b,c){function d(e){if(com.actility.specific.utils.mapIsLoaded()){com.actility.specific.extjs.specificInfo(Ext.getCmp("footer"),com.actility.locale.translate("WR MAP API dependencies loaded"));b(c)}else{com.actility.specific.extjs.specificError(Ext.getCmp("footer"),com.actility.locale.translate("WR MAP API not loaded"))}}function a(e){if(com.actility.specific.utils.mapIsLoaded()){b(c)}else{com.actility.specific.extjs.specificError(Ext.getCmp("footer"),com.actility.locale.translate("WR MAP API not loaded"))}}if(typeof com.actility.global.dependenciesLoadingPhase==="undefined"){com.actility.global.dependenciesLoadingPhase="done";com.actility.specific.extjs.specificInfo(Ext.getCmp("footer"),com.actility.locale.translate("WR Trying to load MAP API dependencies"));com.actility.specific.utils.mapLoadMapDependencies(d,null)}else{a()}},mapIsLoaded:function(){if(com.actility.global.mapService=="OSM"){return com.actility.specific.openstreetmaps.isLoaded()}else{if(com.actility.global.mapService=="GMAPS"){return com.actility.specific.googlemaps.isLoaded()}else{if(com.actility.global.mapService=="BMAPS"){return com.actility.specific.baidumaps.isLoaded()}else{return false}}}},mapLoadMapDependencies:function(a,b){if(com.actility.global.mapService=="OSM"){com.actility.specific.openstreetmaps.loadMapDependencies(a,b)}else{if(com.actility.global.mapService=="GMAPS"){com.actility.specific.googlemaps.loadMapDependencies(a,b)}else{if(com.actility.global.mapService=="BMAPS"){com.actility.specific.baidumaps.loadMapDependencies(a,b)}}}},mapDrawPointLte:function(f,h,e,l,k,b,j,a,i,g){legend='<div class="infwin">';if(e!=-1){legend+="<div><b>Step ["+e+"]</b></div>"}legend+="<div><b>Place ["+k+" "+b+"]</b></div>";legend+="<div><b>"+j+"</b></div>";if(i!=null&&i!="null"&&i!=""){legend+="<div><b>IMEI :"+i+"</b></div>"}if(g!=null&&g!="null"&&g!=""){legend+="<div><b>MSISDN :"+g+"</b></div>"}legend+="<div><b>MTC :"+a+"</b></div>";legend+="</div>";var d=com.actility.specific.utils.mapColor(l);var c="resources/images/white_bullet.png";if(com.actility.global.mapService=="OSM"){return com.actility.specific.openstreetmaps.displayBullet(f,k,b,legend,c,h,d,".",true)}else{if(com.actility.global.mapService=="GMAPS"){return com.actility.specific.googlemaps.displayBullet(f,k,b,legend,c,h,d,".",true)}else{if(com.actility.global.mapService=="BMAPS"){return com.actility.specific.baidumaps.displayBullet(f,k,b,legend,c,h,d,".",true)}}}},mapDrawPointLora:function(h,j,g,o,m,c,i,n,l,b,k,p,a,e){legend='<div class="infwin">';if(g!=-1){legend+="<div><b>Step ["+g+"]</b></div>"}legend+="<div><b>Place ["+m+" "+c+"]</b></div>";legend+="<div><b>"+k+"</b></div>";if(e!=-1){legend+="<div><b>DevEUI :"+e+"</b></div>"}legend+="<div><b>Distance :"+a+"</b></div>";legend+="<div><b>LRR Id :"+p+"</b></div>";legend+="<div><b>RSSI :"+l+"</b></div>";legend+='<div style="background-color:'+com.actility.specific.utils.colorSnr(n)+';"><b>SNR :'+n+"</b></div>";legend+='<div style="background-color:'+com.actility.specific.utils.colorRssi(b)+';"><b>ESP :'+b+"</b></div>";legend+='<div style="background-color:'+com.actility.specific.utils.colorSf(i)+';"><b>SF :'+i+"</b></div>";legend+="</div>";var f=com.actility.specific.utils.mapColor(o);var d="resources/images/white_bullet.png";if(com.actility.global.mapService=="OSM"){return com.actility.specific.openstreetmaps.displayBullet(h,m,c,legend,d,j,f,".",true)}else{if(com.actility.global.mapService=="GMAPS"){return com.actility.specific.googlemaps.displayBullet(h,m,c,legend,d,j,f,".",true)}else{if(com.actility.global.mapService=="BMAPS"){return com.actility.specific.baidumaps.displayBullet(h,m,c,legend,d,j,f,".",true)}}}return marker},mapDrawLRR:function(c,b,h,f,g,e){var d='<div class="infwin">';if(f!=-1&&g!=-1){d+="<div><b>coord ["+f+" "+g+"]</b></div>"}d+="<div><b>LRRid :"+e+"</b></div>";d+="</div>";var a=com.actility.specific.utils.mapColor(h);if(com.actility.global.mapService=="OSM"){com.actility.specific.openstreetmaps.displayLRR(c,f,g,d,b,a)}else{if(com.actility.global.mapService=="GMAPS"){com.actility.specific.googlemaps.displayLRR(c,f,g,d,b,a)}else{if(com.actility.global.mapService=="BMAPS"){com.actility.specific.baidumaps.displayLRR(c,f,g,d,b,a)}}}},mapCallbackDisplayLocalization:function(h,e){var b=e.distance;var g=e.timestampUTC;var d=e.lrrLat;var j=e.lrrLon;var n=e.lrrId;var m=e.devLat;var f=e.devLon;var c=e.deviceUid;var i=e.sf;var l=e.snr;var k=e.rssi;var a=e.esp;if((d!==0)&&(d!==null)&&(d!="null")&&(d!="")&&(d!=undefined)&&(j!==0)&&(j!==null)&&(j!="null")&&(j!="")&&(j!=undefined)){com.actility.specific.utils.mapDrawLRR(h,1,0,d,j,n)}if((m!==0)&&(m!==null)&&(m!="null")&&(m!="")&&(m!=undefined)&&(f!==0)&&(f!==null)&&(f!="null")&&(f!="")&&(f!=undefined)){if(com.actility.global.viewportType=="LTE"){com.actility.specific.utils.mapDrawPointLte(h,2,-1,0,m,f,com.actility.specific.extjs.toolUTCtoLocal(g),e.mtc,e.imei,e.msiisdn)}else{com.actility.specific.utils.mapDrawPointLora(h,2,-1,0,m,f,i,l,k,a,com.actility.specific.extjs.toolUTCtoLocal(g),n,b,c)}}},mapCallbackDisplayLastPositions:function(o,e){var b=e.data;if((b===null)||(typeof b=="undefined")){b=new Array()}var g=new Array();var f=0;var h=new Array();var q=0;for(var n=0;n<b.length;n++){var r=b[n]["DevLAT"];var d=b[n]["DevLON"];if((r!==0)&&(r!==null)&&(r!="null")&&(r!="")&&(r!=undefined)&&(d!==0)&&(d!==null)&&(d!="null")&&(d!="")&&(d!=undefined)){h[q]=b[n];q++}}for(var n=0;n<b.length;n++){if(b[n]["direction"]=="0"){var r=b[n]["DevLAT"];var d=b[n]["DevLON"];if((r!==0)&&(r!==null)&&(r!="null")&&(r!="")&&(r!=undefined)&&(d!==0)&&(d!==null)&&(d!="null")&&(d!="")&&(d!=undefined)){var s=false;for(var l in g){if(g[l]["Lrrid"]==b[n]["Lrrid"]){s=true}}if(s===false){g[b[n]["Lrrid"]]=b[n];g[b[n]["Lrrid"]]["color"]=f;f++}}}}var p=0;for(var n in g){r=g[n]["LrrLAT"];d=g[n]["LrrLON"];if((r!==0)&&(d!==0)&&(r!==null)&&(d!==null)&&(r!="null")&&(r!="")&&(d!="null")&&(d!="")&&(r!=undefined)&&(d!=undefined)){com.actility.specific.utils.mapDrawLRR(o,p,g[n]["color"],g[n]["LrrLAT"],g[n]["LrrLON"],g[n]["Lrrid"]);p++}}b=h;var c=new Array();var a=0;if(b===null){b=new Array()}for(var n=0;n<b.length;n++){if(b[n]["direction"]=="0"){var s=false;for(var l in c){if(c[l]["DevEUI"]==b[n]["DevEUI"]){s=true}}if(s===false){c[b[n]["DevEUI"]]=b[n];a++}}}c.sort();var k=[];var p=0;for(var n in c){if(com.actility.global.viewportType=="LTE"){var m=com.actility.specific.utils.mapDrawPointLte(o,n+10,-1,g[(c[n]["Lrrid"])]["color"],c[n]["DevLAT"],c[n]["DevLON"],com.actility.specific.extjs.toolUTCtoLocal(c[n]["timestampUTC"]),c[n]["Lrrid"],c[n]["DevEUI"],c[n]["lteMSISDN"])}else{var m=com.actility.specific.utils.mapDrawPointLora(o,n+10,-1,g[(c[n]["Lrrid"])]["color"],c[n]["DevLAT"],c[n]["DevLON"],c[n]["SpFact"],c[n]["LrrSNR"],c[n]["LrrRSSI"],c[n]["LrrESP"],com.actility.specific.extjs.toolUTCtoLocal(c[n]["timestampUTC"]),c[n]["Lrrid"],c[n]["distance"],c[n]["DevEUI"])}k.push(m)}},mapCallbackDisplayPath:function(n,u){var e=u.distance;var d=u.lrrLat;var c=u.lrrLon;var m=u.lrrId;var l=u.data;if(l===null||(typeof l=="undefined")){l=new Array()}var r=new Array();var q=0;var a=new Array();var h=0;for(var t=0;t<l.length;t++){var g=l[t]["DevLAT"];var f=l[t]["DevLON"];if((g!==0)&&(g!==null)&&(g!="null")&&(g!="")&&(g!=undefined)&&(f!==0)&&(f!==null)&&(f!="null")&&(f!="")&&(f!=undefined)){a[h]=l[t];h++}}for(var t=0;t<l.length;t++){var o=false;for(var s in r){if(r[s]["Lrrid"]==l[t]["Lrrid"]){o=true}}if(o===false){r[l[t]["Lrrid"]]=l[t];r[l[t]["Lrrid"]]["color"]=q;q++}}var k=0;for(var t in r){var g=r[t]["LrrLAT"];var f=r[t]["LrrLON"];if((g!==0)&&(g!==null)&&(g!="null")&&(g!="")&&(g!=undefined)&&(f!==0)&&(f!==null)&&(f!="null")&&(f!="")&&(f!=undefined)){com.actility.specific.utils.mapDrawLRR(n,k,r[t]["color"],g,f,r[t]["Lrrid"]);k++}}l=a;var p=[];var b=1;for(var t=l.length-1;t>=0;t--){if(com.actility.global.viewportType=="LTE"){com.actility.specific.utils.mapDrawPointLte(n,t+10,b,r[(l[t]["Lrrid"])]["color"],l[t]["DevLAT"],l[t]["DevLON"],com.actility.specific.extjs.toolUTCtoLocal(l[t]["timestampUTC"]),l[t]["Lrrid"],l[t]["DevEUI"],l[t]["lteMSISDN"])}else{com.actility.specific.utils.mapDrawPointLora(n,t+10,b,r[(l[t]["Lrrid"])]["color"],l[t]["DevLAT"],l[t]["DevLON"],l[t]["SpFact"],l[t]["LrrSNR"],l[t]["LrrRSSI"],l[t]["LrrESP"],com.actility.specific.extjs.toolUTCtoLocal(l[t]["timestampUTC"]),l[t]["Lrrid"],l[t]["distance"],-1)}p.push({lat:l[t]["DevLAT"],lon:l[t]["DevLON"]});b++}if(com.actility.global.mapService=="OSM"){com.actility.specific.openstreetmaps.displayPolyline(n,p,"#FF0000")}else{if(com.actility.global.mapService=="GMAPS"){com.actility.specific.googlemaps.displayPolyline(n,p,"#FF0000")}else{if(com.actility.global.mapService=="BMAPS"){com.actility.specific.baidumaps.displayPolyline(n,p,"#FF0000")}}}},buildMapPanel:function(a){if(com.actility.global.mapService=="GMAPS"){com.actility.specific.googlemaps.buildMapPanel(a)}else{if(com.actility.global.mapService=="OSM"){com.actility.specific.openstreetmaps.buildMapPanel(a)}else{if(com.actility.global.mapService=="BMAPS"){com.actility.specific.baidumaps.buildMapPanel(a)}}}},buildDisclaimer:function(b){var a=function(d){if(typeof d=="undefined"){return true}if(d.length==0){return true}return false};var c=new Ext.Window({width:400,height:500,modal:true,bodyStyle:"background-color: #c5ddf5",border:false,closable:true,overflowY:"auto",layout:"anchor",margin:0});c.add({xtype:"panel",width:"100%",height:"100%",bodyStyle:"background-color: #c5ddf5",overflowY:"auto",layout:{type:"vbox",align:"center",pack:"center"},items:[{xtype:"container",width:"90%",left:20,cls:"disclaimer",itemId:"msg",html:b.disclaimerMessage,hidden:a(b.disclaimerMessage)},{margin:"20 0 15 0",xtype:"label",itemId:"userName",text:b.who,hidden:a(b.who),cls:"disclaimerUserName"},{xtype:"displayfield",fieldLabel:"${LBL Last successful login}",labelWidth:150,value:b.previousConnection,hidden:a(b.previousConnection)},{xtype:"displayfield",fieldLabel:"${LBL Last unsuccessful login}",labelWidth:150,value:b.thingparkLastUnsuccessfulLogin,hidden:a(b.thingparkLastUnsuccessfulLogin)},{xtype:"displayfield",fieldLabel:"${LBL Number of failed logins since last successful login}",value:b.thingparkPreviousBadConsecutivePwd,labelWidth:300,labelStyle:"width:300px!important",hidden:a(b.thingparkPreviousBadConsecutivePwd)},{margin:"15 0 15 0",xtype:"button",text:"${BTN Accept}",handler:function(d){c.destroy();b.onButtonPress.call(this,b.type)}}]});c.show();return c},buildLFDTable:function(lfd){if(lfd!=null&&lfd.length>0){var output="<br><br><table class='chainList'>";output+="<thead><tr><td>"+com.actility.locale.translate("LBL Delivery Failed Cause")+"</td><td>"+com.actility.locale.translate("LBL Number of occurrences")+"</td></tr></thead>";output+="<tbody>";var lfdObj=eval(lfd);for(var i=0;i<lfdObj.length;i++){output+="<tr><td>"+com.actility.specific.utils.decodeTranslateDeliveryFailedCauseLfd(lfdObj[i].dfc)+"</td><td>"+lfdObj[i].cnt+"</td></tr>"}output+="</tbody></table>";return output}else{return""}},decodeTranslateDeliveryStatus:function(a){var b;if(a.length==0){b=com.actility.locale.translate("TXT DS Unknown")}else{if(a=="null"){b=com.actility.locale.translate("TXT DS Unknown")}else{if(a=="0"){b=com.actility.locale.translate("TXT DS Failed")}else{if(a=="1"){b=com.actility.locale.translate("TXT DS Sent")}else{b=com.actility.locale.translate("TXT DS Unknown status");b+="("+a+")"}}}}return b},decodeTranslateDeliveryFailedCauseLfd:function(b){var c;if(b==null){return""}if(b=="null"){return""}if(b.length==0){return""}if(b=="00"){return c=com.actility.locale.translate("TXT DC1 Success")}if(b.length!=2){return""}var a=b.substr(0,1);if(a=="A"){c=com.actility.locale.translate("TXT LFD: Transmission slot busy")}else{if(a=="B"){c=com.actility.locale.translate("TXT LFD: Too late")}else{if(a=="D"){c=com.actility.locale.translate("TXT LFD: DC constraint")}else{if(a=="E"){c=com.actility.locale.translate("TXT LFD: Frame expired")}else{if(a=="F"){c=com.actility.locale.translate("TXT LFD: Multicast failure")}else{c=com.actility.locale.translate("TXT DC1 Unknown cause")}}}}}c+="("+b+")";return c},decodeTranslateDeliveryFailedCause1:function(b){var c;if(b==null){return""}if(b=="null"){return""}if(b.length==0){return""}if(b=="00"){return c=com.actility.locale.translate("TXT DC1 Success")}if(b.length!=2){return""}var a=b.substr(0,1);if(a=="A"){c=com.actility.locale.translate("TXT DC1 Class A: Transmission slot busy on RX1")}else{if(a=="B"){c=com.actility.locale.translate("TXT DC1 Class A: Too late for RX1")}else{if(a=="C"){c=com.actility.locale.translate("TXT DC1 Class A: LRC selected RX2")}else{if(a=="D"){c=com.actility.locale.translate("TXT DC1 Class A: DC constraint on RX1")}else{if(a=="E"){c=com.actility.locale.translate("TXT DC1 Class A: Frame expired before transmission")}else{c=com.actility.locale.translate("TXT DC1 Unknown cause")}}}}}c+="("+b+")";return c},decodeTranslateDeliveryFailedCause2:function(b){var c;if(b==null){return""}if(b=="null"){return""}if(b.length==0){return""}if(b=="00"){return c=com.actility.locale.translate("TXT DC2 Success")}if(b.length!=2){return""}var a=b.substr(0,1);if(a=="A"){c=com.actility.locale.translate("TXT DC2 Class A: Transmission slot busy on RX2")}else{if(a=="B"){c=com.actility.locale.translate("TXT DC2 Class A: Too late for RX2")}else{if(a=="D"){c=com.actility.locale.translate("TXT DC2 Class A: DC constraint on RX2")}else{if(a=="E"){c=com.actility.locale.translate("TXT DC2 Class C: Frame expired before transmission")}else{if(a=="F"){c=com.actility.locale.translate("TXT DC2 Class C: Multicast failure")}else{c=com.actility.locale.translate("TXT DC2 Unknown cause")}}}}}c+="("+b+")";return c},decodeTranslateDeliveryFailedCause3:function(a){var c;if(a==null){return""}if(a=="null"){return""}if(a.length==0){return""}if(a=="00"){return c=com.actility.locale.translate("TXT DC3 Success")}if(a.length!=2){return""}var b=a.substr(0,1);if(b=="A"){c=com.actility.locale.translate("TXT DC3 Class B: Transmission slot busy on ping slot")}else{if(b=="B"){c=com.actility.locale.translate("TXT DC3 Class B: Too late for ping slot")}else{if(b=="D"){c=com.actility.locale.translate("TXT DC3 Class B: DC constraint on ping slot")}else{if(b=="F"){c=com.actility.locale.translate("TXT DC3 Class B: Multicast failure")}else{c=com.actility.locale.translate("TXT DC3 Unknown cause")}}}}c+="("+a+")";return c}}});