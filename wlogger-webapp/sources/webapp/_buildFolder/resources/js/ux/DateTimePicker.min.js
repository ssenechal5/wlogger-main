Ext.define("Ext.ux.DateTimePicker",{extend:"Ext.picker.Date",alias:"widget.datetimepicker",requires:["Ext.picker.Date","Ext.slider.Single","Ext.form.field.Time","Ext.form.Label"],todayText:"Current Date",hourText:"Hour",minuteText:"Minutes",initEvents:function(){var c=this,a=Ext.Date,b=a.DAY;Ext.apply(c.keyNavConfig,{up:function(d){if(d.ctrlKey){if(d.shiftKey){c.minuteSlider.setValue(c.minuteSlider.getValue()+1)}else{c.showNextYear()}}else{if(d.shiftKey){c.hourSlider.setValue(c.hourSlider.getValue()+1)}else{c.update(a.add(c.activeDate,b,-7))}}},down:function(d){if(d.ctrlKey){if(d.shiftKey){c.minuteSlider.setValue(c.minuteSlider.getValue()-1)}else{c.showPrevYear()}}else{if(d.shiftKey){c.hourSlider.setValue(c.hourSlider.getValue()-1)}else{c.update(a.add(c.activeDate,b,7))}}}});c.callParent()},initComponent:function(){var b=this,a=b.value?new Date(b.value):new Date();a.setSeconds(0);b.timeFormat=~b.format.indexOf("h")?"h":"H";b.hourSlider=new Ext.slider.Single({fieldLabel:b.hourText,labelAlign:"top",labelSeparator:" ",padding:"0 0 10 17",focusable:false,value:0,minValue:0,maxValue:23,vertical:true,listeners:{change:b.changeTimeValue,scope:b}});b.minuteSlider=new Ext.slider.Single({fieldLabel:b.minuteText,labelAlign:"top",labelSeparator:" ",padding:"0 10 10 0",focusable:false,value:0,increment:1,minValue:0,maxValue:59,vertical:true,listeners:{change:b.changeTimeValue,scope:b}});b.callParent();b.setValue(new Date(a))},afterRender:function(){var a=this;a.timePicker=Ext.create("Ext.panel.Panel",{layout:{type:"hbox",align:"stretch"},border:false,defaults:{flex:1},width:130,floating:true,dockedItems:[{xtype:"toolbar",dock:"top",ui:"footer",items:["->",{xtype:"label",text:a.timeFormat=="h"?"12:00 AM":"00:00"},"->"]}],items:[a.hourSlider,a.minuteSlider],onMouseDown:function(b){b.preventDefault()}});a.callParent()},handleTabClick:function(a){this.handleDateClick(a,this.activeCell.firstChild,true)},getSelectedDate:function(a){var d=this,h=Ext.Date.clearTime(a,true).getTime(),i=d.cells,j=d.selectedCls,f=i.elements,e=f.length,g,b;i.removeCls(j);for(b=0;b<e;b++){g=f[b].firstChild;if(g.dateValue===h){return g}}return null},changeTimeValue:function(b,i,j){var k=this,l=k.timePicker.down("label"),g=k.minuteSlider.getValue()<10?"0":"",n=k.hourSlider.getValue(),m,a,h,d,c,f;if(k.timeFormat=="h"){c=k.hourSlider.getValue()<12?" AM":" PM";n=k.hourSlider.getValue()<13?n:n-12;n=n||"12"}d=n<10?"0":"";l.setText(d+n+":"+g+k.minuteSlider.getValue()+(c||""));if(k.pickerField&&(m=k.pickerField.getValue())){a=k.hourSlider.getValue();h=k.minuteSlider.getValue();f=new Date(m.setHours(a,h));k.pickerField.setValue(f)}},onShow:function(){var a=this;a.showTimePicker();a.callParent()},showTimePicker:function(){var b=this,a=b.el;Ext.defer(function(){var d=Ext.getBody(),c=d.getViewSize().width,g=(c<(a.getX()+a.getWidth()+140))?"tl":"tr",h=g=="tl"?-135:5,e,f;b.timePicker.setHeight(a.getHeight());b.timePicker.showBy(b,g,[h,0]);f=b.timePicker.down("toolbar").getEl();e=f.getStyle("background-color");if(e=="transparent"){f.setStyle("background-color",f.getStyle("border-color"))}},1)},onHide:function(){var a=this;a.timePicker.hide();a.callParent()},beforeDestroy:function(){var a=this;if(a.rendered){Ext.destroy(a.timePicker,a.minuteSlider,a.hourSlider)}a.callParent()},setValue:function(a){a.setSeconds(0);this.value=new Date(a);return this.update(this.value)},selectToday:function(){var c=this,a=c.todayBtn,b=c.handler,d=new Date();if(a&&!a.disabled){c.setValue(new Date(d.setSeconds(0)));c.fireEvent("select",c,c.value);if(b){b.call(c.scope||c,c,c.value)}c.onSelect()}return c},handleDateClick:function(h,b,g){var d=this,c=d.handler,a=d.timePicker.items.items[0].getValue(),f=d.timePicker.items.items[1].getValue(),i=new Date(b.dateValue);if(g!==true){h.stopEvent()}if(!d.disabled&&b.dateValue&&!Ext.fly(b.parentNode).hasCls(d.disabledCellCls)){d.doCancelFocus=d.focusOnSelect===false;i.setHours(a,f,0);d.setValue(new Date(i));delete d.doCancelFocus;d.fireEvent("select",d,d.value);if(c){c.call(d.scope||d,d,d.value)}d.onSelect()}},selectedUpdate:function(c){var d=this,b=Ext.Date.clearTime(c,true),a=(d.pickerField&&d.pickerField.getValue())||new Date();this.callParent([b]);if(a){Ext.defer(function(){d.hourSlider.setValue(a.getHours());d.minuteSlider.setValue(a.getMinutes())},10)}},fullUpdate:function(c){var d=this,b=Ext.Date.clearTime(c,true),a=(d.pickerField&&d.pickerField.getValue())||new Date();this.callParent([b]);if(a){Ext.defer(function(){d.hourSlider.setValue(a.getHours());d.minuteSlider.setValue(a.getMinutes())},10)}}});