Ext.define("com.actility.specific.openstreetmaps",{statics:{_translatePosition:function(a,b){return{lat:a,lon:b}},_getPosition:function(a,b){translatedPos=this._translatePosition(a,b);return new L.LatLng(translatedPos.lat,translatedPos.lon)},_extendMap:function(a,c){if(typeof a.bounds=="undefined"){var b={stroke:false,strokeOpacity:0,weight:0,color:"#FF0000",opacity:0,fill:false,radius:50};lrrCircle=new L.circle(c,b);lrrCircle.addTo(a);a.bounds=lrrCircle.getBounds();a.fitBounds(lrrCircle.getBounds())}else{a.bounds.extend(c);a.fitBounds(a.bounds)}},loadMapDependencies:function(c,a){var b=["resources/js/leaflet/leaflet-src.min.js","resources/js/leaflet.markercluster/leaflet.markercluster-src.min.js","resources/css/leaflet/leaflet.css","resources/css/leaflet/addOn.css","resources/css/leaflet.markercluster/MarkerCluster.css","resources/css/leaflet.markercluster/MarkerCluster.Default.css","resources/js/ux/LeafletPanel.min.js"];var d=new ScriptLoader(b,c,a);d.loadFiles()},isLoaded:function(){return(typeof L=="object")},displayBullet:function(f,j,a,i,c,h,d,b,l){if(l==true){if(typeof f.clusterMarker=="undefined"){f.clusterMarker=L.markerClusterGroup({spiderfyOnMaxZoom:false,disableClusteringAtZoom:12,showCoverageOnHover:false,zoomToBoundsOnClick:true,animate:true,chunkedLoading:true,chunkProgress:function(){}})}}var k=this._getPosition(j,a);var g=L.divIcon({className:"leaflet-div-icon",iconSize:[20,20],iconAnchor:[10,10],popupAnchor:[0,-10]});var e=L.marker(k,{icon:g});e.bindPopup(i);e.on("add",function(){this.valueOf()._icon.style.backgroundColor=d});e.on("mouseover",function(m){this.openPopup()});if(l==true){f.clusterMarker.addLayer(e);f.addLayer(f.clusterMarker)}else{e.addTo(f)}this._extendMap(f,k)},displayPolyline:function(d,f,c){var a=[];for(var e=0;e<f.length;e++){a.push(this._getPosition(f[e].lat,f[e].lon))}var b=new L.Polyline(a,{weight:2,opacity:0.9,color:c});d.addLayer(b)},displayLRR:function(d,g,a,f,e,b){var i=L.icon({iconUrl:com.actility.global.buildUrl("/gui/resources/images/lrr_"+b+".png"),iconSize:[62,90],iconAnchor:[31,45],popupAnchor:[0,-40]});var h=this._getPosition(g,a);var c=L.marker(h,{icon:i});c.addTo(d);c.bindPopup(f);c.on("mouseover",function(j){this.openPopup()});this._extendMap(d,h)},buildMapPanel:function(a){L.Icon.Default.imagePath="resources/images/leaflet";var d=null;var c=Ext.create("Ext.window.Window",{title:a.title,layout:"fit",width:450,height:450,x:10,y:10,border:true,maximizable:true,items:{xtype:"leafletpanel",width:"100%",height:"100%",listeners:{mapready:b,resize:e}}});function b(f,g){d=g;a.onMapReady.call(this,g,a)}function e(h,g,f){if(typeof h.firstResize=="undefined"){h.firstResize=true}else{if(d!=null){d.invalidateSize()}}}c.show()}}});